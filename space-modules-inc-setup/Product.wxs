<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
	<Product Id="2abadc3f-3581-4618-bd2e-bee3d1a3973b" Name="Space Modules Inc" Language="1033" Version="1.0.0.0" Manufacturer="PlayGen" UpgradeCode="dfcb41fd-5e8e-4dad-a13d-9fc440518b05">
		<Package Id="*" InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <Condition Message="You need to be an administrator to install this product.">
      Privileged
    </Condition>

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<MediaTemplate />

    <Property Id="INSTALLDIR">
      <RegistrySearch Id="PlayGenSplLauncherRegistry" Type="raw" Root="HKLM" Key="SOFTWARE\[Manufacturer]\SPL Launcher" Name="InstallDir"/>
    </Property>


    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="INSTALLDIR">
        <Directory Id="smiDIR" Name="SpaceModulesInc">
          <Component Id="MainExecutable" Guid="73b1531f-f68b-4f9b-a0f4-fc271c4d6aec">
            <File Id="smiEXE" Source="$(var.space-modules-inc.ProjectDir)/SMI.exe" KeyPath="yes" />
          </Component>
          <Component Id="ChangeConfig" Guid="59fa452a-cf8d-4ee3-ac75-287ec94fb929" KeyPath="yes">
            <util:XmlConfig Id="elem1"
															Action="create"
															ElementPath="/configuration/GameConfiguration/games"
															File="[INSTALLDIR]PlayGen.SPL.Launcher.exe.config"
															Node="element"
															On="install"
															Name="add"
															Sequence="1">
              <util:XmlConfig Id="elem11"
                              ElementId="elem1"
                              Name="id"
                              Value="smispl"
                              File="[INSTALLDIR]PlayGen.SPL.Launcher.exe.config"/>
              <util:XmlConfig Id="elem12"
                              ElementId="elem1"
                              Name="path"
                              Value="[smiDIR]SMI.exe"
                              File="[INSTALLDIR]PlayGen.SPL.Launcher.exe.config"/>
            </util:XmlConfig>

            <util:XmlConfig   Id="elem1Delete"
															Action="delete"
															ElementPath="/configuration/GameConfiguration/games"
															VerifyPath="/configuration/GameConfiguration/games/add[\[]@id='smispl'[\]]"
															File="[INSTALLDIR]PlayGen.SPL.Launcher.exe.config"
															Node="element"
															On="uninstall"
															Sequence="100" />
          </Component>
        </Directory>
      </Directory>
    </Directory>

    <Feature Id="ProductFeature" Title="space_modules_inc_setup" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="ChangeConfig"/>
      <ComponentGroupRef Id="SourceComponentGroup"/>
    </Feature>
	</Product>

</Wix>
